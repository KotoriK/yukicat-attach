(self.webpackChunkyukicat_attach=self.webpackChunkyukicat_attach||[]).push([[913],{486:function(e,t,s){s.d(t,{t:function(){return v}});var n=s(893),a=s(723),o=s(294),r=s(935),i=s(778),c=s(567);const l=/[0-9]{1,}/,{body:d}=document,u=(0,c.QM)((()=>({clickable:{cursor:"pointer"}}))),h=(0,c.QM)((()=>({popper:{opacity:0,visibility:"hidden",background:"#33333380",color:"white",padding:"4px 8px",fontSize:"13px",borderRadius:"4px",maxHeight:"20vh",overflow:"auto",'&[data-show="true"]':{opacity:1,visibility:"visible",backdropFilter:"blur(3px)"},zIndex:999},"opacity-trans":{transition:"opacity 500ms ease-in-out"}}))),f=(e,t=2)=>{const s=("string"==typeof e?parseFloat(e):e)/3600,n=0|s,a=60*(s-n),o=0|a,r=60*(a-o);return`${n>0?`${n}小时`:""}${o>0?`${o}分`:""}${r>0?`${r-(0|r)>0?r.toFixed(t):r}秒`:""}`},p=(0,o.forwardRef)((({data:{hit:e,avgTOP:t},style:s,show:a},o)=>{const r=h();return(0,n.jsxs)("div",Object.assign({className:r.popper+" "+r["opacity-trans"],"data-show":a,ref:o,style:s},{children:[(0,n.jsx)("li",{children:`浏览量:${e}`},void 0),t?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("li",{children:`平均浏览时间:${f(t)}`},void 0),(0,n.jsx)("li",{children:`总浏览时间:${f(parseFloat(t)*parseInt(e),0)}`},void 0)]},void 0):null]}),void 0)})),m={fetcher:e=>fetch(e).then((e=>e.json())),revalidateOnFocus:!1,revalidateOnReconnect:!1};function g({path:e,raw:t}){const s=e+(e.endsWith("/")?"":"/"),{data:c,error:h}=(0,a.ZP)("https://yukicat-ga-hit.vercel.app/api/ga/?page="+s,m),f=t.replace(/<\/?span>/g,""),[g,v]=(0,o.useState)(),[x,y]=(0,o.useState)(),[b,j]=(0,o.useState)(!1),[k,w]=(0,o.useState)(),{styles:O,update:C}=(0,i.D)(g,x,{placement:"top",modifiers:[{name:"eventListeners",options:{resize:!0,scroll:b}}]}),_=u();return(0,o.useEffect)((()=>()=>clearTimeout(k)),[]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",Object.assign({onClick:()=>{j(!b),k&&clearTimeout(k),w(window.setTimeout((()=>{j(b),w(void 0)}),5e3))},ref:v,"data-raw":t,className:_.clickable},{children:h?f.replace(l,"-"):c?f.replace(l,c[0].hit):f}),void 0),(0,r.createPortal)((0,n.jsx)(p,{ref:y,data:c&&c[0]||{hit:f},style:O.popper,show:b},void 0),d)]},void 0)}const v=()=>{var e;const t=document.getElementsByClassName("meta-page-view");for(let s=0;s<t.length;s++){const a=t[s],o=null===(e=a.attributes.getNamedItem("data-path"))||void 0===e?void 0:e.value,i=a.innerText;(0,r.hydrate)((0,n.jsx)(g,{path:o,raw:i},void 0),a)}}},617:function(e,t,s){var n,a,o=s(935),r=s(294);const i=/(http[\S]+) ([0-9]+)w/i;function c(e){const t=e.target;if(t.dataset.fullUrl)l(t.dataset.fullUrl);else{if(t.srcset){let e=0,s="";return t.srcset.split(",").forEach((t=>{const n=i.exec(t);if(3==n.length){let t=parseInt(n[2]);t>e&&(e=t,s=n[1])}})),void l(s||t.src)}l(t.src)}}function l(e){d(!0,e)}function d(e,t){(0,o.render)((0,r.createElement)(a,{imgSrc:t,opacity:e,handleOpacityChange:d}),n)}var u=()=>{const e=document.querySelectorAll("div.entry-content img:not(.avatar)");if(e.length>0){const t=document.body.appendChild(document.createElement("div"));e.forEach((e=>{e.addEventListener("click",c)})),s.e(532).then(s.bind(s,532)).then((({ImageModalWithEXIF:e})=>{a=e,n=t,l()}))}},h=s(893);var f;!function(e){e[e.PRELOAD=0]="PRELOAD",e[e.ERROR=1]="ERROR"}(f||(f={}));const p=["https://cdn.jsdelivr.net/gh/YukiCat-Dev/FacePack/static/Ripple-1.3s-237px.svg","https://cdn.jsdelivr.net/gh/YukiCat-Dev/FacePack/static/error.svg"];var m=({level:e,description:t,style:s,className:n})=>(0,h.jsx)("img",{src:p[e],alt:t,style:s,className:n},void 0);function g(e){const[t,s]=(0,r.useState)(!1),[n,a]=(0,r.useState)({level:f.PRELOAD}),o=(0,r.useContext)(N),i=(0,r.useCallback)((()=>{s(!1),a({level:f.ERROR})}),[]),c=(0,r.useCallback)((()=>{a(null),s(!0)}),[]);return(0,h.jsxs)(h.Fragment,{children:[n&&(0,h.jsx)(m,Object.assign({},n,{style:Object.assign(Object.assign({},e.style),{transition:"opacity 2s ease"}),className:e.className}),void 0),(0,h.jsx)("img",{src:e.src,onClick:t=>e.onClick(t,e.face_pos),onPointerEnter:()=>o.showPeak(e.src,e.alt),onPointerOut:()=>o.hidePeak(),alt:e.alt,style:Object.assign({},e.style),className:e.className,onLoad:c,hidden:!t,onError:i},void 0)]},void 0)}var v=s(567);const x=(0,v.QM)({td:{textAlign:"center",border:"1pt solid #888",padding:"1.5px"},pic:{width:"40px",height:"40px"},wrap:{overflowY:"auto",overflowX:"hidden"}});var y=(0,r.forwardRef)((function({facePackage:e,onImageSelected:t,colCount:s},n){const a=x(),o=e.id,i=(0,r.useCallback)(((e,s)=>{t(s)}),[t]),c=(0,r.useMemo)((()=>e.faces.map(((e,t)=>(0,h.jsx)("td",Object.assign({className:a.td},{children:(0,h.jsx)(g,{src:e.url,alt:e.id,face_pos:t,className:a.pic,onClick:i},void 0)}),o+t)))),[e]),l=(0,r.useMemo)((()=>{const e=Math.ceil(c.length/s),t=new Array(e);for(let n=0;n<e;n++){const e=n*s;t[n]=(0,h.jsx)("tr",{children:c.slice(e,e+s)},o+"r"+n)}return t}),[c,s]);return(0,h.jsx)("div",Object.assign({className:a.wrap,ref:n},{children:(0,h.jsx)("table",{children:(0,h.jsx)("tbody",{children:l},void 0)},void 0)}),void 0)}));function b(e){return(0,h.jsx)("option",Object.assign({selected:e.selected,style:Object.assign({},e.style),className:e.className,value:e.pos},{children:e.name}),void 0)}function j(e){var t,s,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(s=j(e[t]))&&(n&&(n+=" "),n+=s);else for(t in e)e[t]&&(n&&(n+=" "),n+=t);return n}function k(){for(var e,t,s=0,n="";s<arguments.length;)(e=arguments[s++])&&(t=j(e))&&(n&&(n+=" "),n+=t);return n}var w=(0,v.QM)({borderShadow:{boxShadow:"2px 2px 15px #888888",border:"0.5px #888888 solid",zIndex:999},bgWhiteBlur:{backgroundColor:"rgba(255,255,255,0.6)",backdropFilter:"blur(3px)"},main:{padding:"2px",height:325}});const O=(0,v.QM)({root:{width:"100%",border:0,fontWeight:"bold"}});var C=(0,r.forwardRef)((function(e,t){return(0,h.jsx)("select",Object.assign({ref:t,className:k(O().root,w().bgWhiteBlur),onChange:t=>e.onSelected(t.target.value)},{children:(0,r.useMemo)((()=>e.facePackages.map(((t,s)=>(0,h.jsx)(b,{pos:s,name:t.name,selected:s===e.selectedPos},t.id)))),[e.facePackages])}),void 0)}));const _=(0,v.QM)({figCaption:{textAlign:"center",backgroundColor:"rgba(255,255,255,0.65)"},hr:{marginTop:0,marginBottom:0}});var P=(0,r.forwardRef)(((e,t)=>{const s=_(),n=w();return(0,h.jsxs)("figure",Object.assign({style:Object.assign({display:e.show?"block":"none"},e.style),className:k(n.borderShadow,e.className,n.bgWhiteBlur),ref:t},{children:[(0,h.jsx)("img",{src:e.imgUrl,height:200},void 0),(0,h.jsx)("hr",{className:s.hr},void 0),(0,h.jsx)("figcaption",Object.assign({className:k(s.figCaption,n.bgWhiteBlur)},{children:e.imgCaption}),void 0)]}),void 0)})),S=s(778);const E=(0,v.QM)((()=>({col:{flex:1,width:"45px",height:"45px",padding:"1px 1px 1px 1px"},row:{flexWrap:"wrap",overflow:"auto"}})));var R=(0,r.forwardRef)((function({facePackage:e,onImageSelected:t},s){const n=E(),a=(0,r.useCallback)(((e,s)=>{t(s)}),[t]),o=e.faces.map(((t,s)=>(0,h.jsx)(g,{src:t.url,alt:t.id,face_pos:s,className:n.col,onClick:a},e.id+t.id)));return(0,h.jsx)("div",Object.assign({ref:s,className:n.row},{children:o}),void 0)}));const N=(0,r.createContext)({});function $({children:e}){return e(w())}function T({peakPopperOptions:e,facePacks:t,style:s,className:n,colCount:a,onFaceSelected:o,handleHide:i,loadContent:c,grid:l}){const[d,u]=(0,r.useState)(0),[f,p]=(0,r.useState)(!1),[m,g]=(0,r.useState)(),[v,x]=(0,r.useState)(),[b,j]=(0,r.useState)(),[w,O]=(0,r.useState)(),_=(0,r.useRef)(),E=(0,r.useRef)(),{styles:T,update:F}=(0,S.D)(b,w,e),A=(0,r.useCallback)((e=>{const s=t[d];o(s,s.faces[e]),i()}),[i,o,t,d]);(0,r.useEffect)((()=>{c&&(E.current.style.height=325-_.current.clientHeight+"px")}),[c]);let M=d;const H=t.length-1;return M>H&&(M=H),(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)($,{children:e=>(0,h.jsxs)("div",Object.assign({ref:j,style:Object.assign({},s),className:n||k(e.borderShadow,e.bgWhiteBlur,e.main)},{children:[(0,h.jsx)(C,{facePackages:t,onSelected:e=>u(e),selectedPos:M,ref:_},void 0),(0,h.jsx)(N.Provider,Object.assign({value:(0,r.useMemo)((()=>({showPeak:(e,t)=>{g(e),x(t),p(!0),F&&F()},hidePeak:()=>p(!1)})),[g,x,p,F])},{children:c?"table"==l?(0,h.jsx)(y,{ref:E,facePackage:t[M],colCount:a,onImageSelected:A},void 0):(0,h.jsx)(R,{ref:E,facePackage:t[M],onImageSelected:A},void 0):null}),void 0)]}),void 0)},void 0),(0,h.jsx)(P,{imgCaption:v,imgUrl:m,ref:O,show:f,style:T.popper},void 0)]},void 0)}class F extends class{constructor(e){this._displayed=!0,this._loadContent=!1,this._onFaceSelected=e.onFaceSelected||function(){},this._facePacks=e.facePackages,this._style=e.style,this._className=e.className,this._peakPopperOptions=e.peakPopperOptions}_render(e){(0,o.render)((0,h.jsx)(T,{facePacks:this._facePacks,colCount:4,handleHide:this.switchHide.bind(this),onFaceSelected:this._onFaceSelected,peakPopperOptions:this._peakPopperOptions,style:this._style,className:this._className,loadContent:this._loadContent},void 0),e)}}{constructor(e){super(e),this._self=e.self}switchHide(){return this._displayed?(this._self.setAttribute("hidden","hidden"),this._displayed=!1):(this._self.removeAttribute("hidden"),this._loadContent||(this._loadContent=!0,this.render()),this._displayed=!0),this}unload(){return(0,o.unmountComponentAtNode)(this._self),this}render(){return this._render(this._self),this}}function A(e,t,s,n){let a=!1,o="",r="";for(const i of n)switch(i){case e:a?e==t?(a=!1,o+=s(r),r=""):(a=!1,o+=`${e}${r}${e}`,r=""):a=!0;break;case t:a?(a=!1,o+=s(r),r=""):o+=i;break;case" ":case"\n":case"\r":case"\t":case"\v":case"\f":a?(a=!1,o+=`${e}${r}${i}`,r=""):o+=i;break;default:a?r+=i:o+=i}return""!=r&&(o+=e+r,a=!1),a&&(o+=e),o}class M{constructor(e,t="",s="",n=":",a=":"){this._faceMap=new Map,this._className=t,this._inlineStyle=s,this.LEFT_BRACKET=n,this.RIGHT_BRACKET=a;for(const t of e)for(const e of t.faces)this._faceMap.set(`${t.id}.${e.id}`,e.url)}render(e){const t=e.innerHTML,s=this.renderText(t);s!==t&&(e.innerHTML=s)}renderText(e){return A(this.LEFT_BRACKET,this.RIGHT_BRACKET,this.replacePlaceHolder.bind(this),e)}replacePlaceHolder(e){const t=this._faceMap.get(e);return t?`<img class="${this._className}" src="${t}" style="${this._inlineStyle} max-height:6vh;" alt="${this.LEFT_BRACKET}${e}${this.RIGHT_BRACKET}"/>`:`${this.LEFT_BRACKET}${e}${this.RIGHT_BRACKET}`}}var H=function(e,t,s,n){return new(s||(s=Promise))((function(a,o){function r(e){try{c(n.next(e))}catch(e){o(e)}}function i(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,i)}c((n=n.apply(e,t||[])).next())}))};var I=function(e,t){var s={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(s[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(s[n[a]]=e[n[a]])}return s};function B(e,t){const s="string"==typeof e?{id:e}:e,n=e=>A("{","}",(e=>"id"==e?s.id:e in t?t[e]:`{${e}}`),e),{url:a}=s,o=I(s,["url"]);return Object.assign(Object.assign({},o),{url:n(a&&n(a)||t.default)})}var L=function(e,t,s,n){return new(s||(s=Promise))((function(a,o){function r(e){try{c(n.next(e))}catch(e){o(e)}}function i(e){try{c(n.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,i)}c((n=n.apply(e,t||[])).next())}))};function D(e){return L(this,void 0,void 0,(function*(){const t=yield function(e){return H(this,void 0,void 0,(function*(){return fetch(e,{method:"GET"}).then((e=>{if(e.ok)return e.json();throw new Error(`Fetch Error:Return HTTP ${e.status}, ${e.statusText}`)}))}))}(e);if(t)return function(e){for(const t of e)t.faces=t.faces.map((e=>B(e,t)))}(t),t;throw new Error(`Try to load FacePacks from '${e}' failed.`)}))}var W=s(486);function K(){(0,W.t)(),u(),D("https://cdn.jsdelivr.net/gh/YukiCat-Dev/yukicat.facepack/facepacks.json").then((e=>{(e=>{const t=new M(e);document.querySelectorAll("article.hentry p:not(.ct-respond-form-textarea):not(.form-submit)").forEach((e=>{t.render(e)})),document.querySelectorAll(".commentwrap .body > p").forEach((e=>{t.render(e)}))})(e),(e=>{const t=document.querySelector("#comment"),s=new F({facePackages:e,onFaceSelected:(e,s)=>t.value+=`:${e.id}.${s.id}:`,peakPopperOptions:{placement:"right",modifiers:[{name:"offset",options:{offset:[0,20]}}]},self:document.querySelector(".emotion-box"),className:" "}).render().switchHide();document.getElementById("emotion-toggle").addEventListener("click",(()=>{s.switchHide()}))})(e)})).finally((()=>console.log("post_loaded")))}document.addEventListener("pjax:complete",(()=>{K()})),"complete"===document.readyState?K():document.addEventListener("DOMContentLoaded",(()=>{K()}))}},function(e){e.O(0,[896],(function(){return t=617,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=post.js.map